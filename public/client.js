(()=>{"use strict";function e(e){return document.querySelector(e)}function t(e,t="",o=""){return"<"+e+' class="'+t+'">'+o+"</"+e+">"}e(".js-mouseContainer"),e(".js-gameContent"),t("div","centered medium",t("div","divider"));const o=e(".js-mainCanvas");window.mainCanvas=o;const s=function(e){const t=e.getContext("2d");if(!t)throw new Error("Failed to get context");return t}(o);function n(e,t,o){var s,n;e.save(),e.beginPath(),e.arc(o.x,o.y,o.size,0,2*Math.PI),e.strokeStyle=null!==(s=o.primaryColor)&&void 0!==s?s:"white",e.stroke(),e.beginPath(),e.moveTo(o.x+2*o.size/7,o.y+7*o.size/8),e.bezierCurveTo(o.x-o.size/2,o.y+o.size/2,o.x-o.size,o.y-o.size,o.x-o.size/2,o.y-o.size/2),e.moveTo(o.x-o.size/2,o.y-o.size/2),e.bezierCurveTo(o.x+o.size,o.y+o.size,o.x+o.size/2,o.y+o.size,o.x+o.size/2,o.y-o.size/2),e.strokeStyle=null!==(n=o.secondaryColor)&&void 0!==n?n:"white",e.stroke(),e.restore()}function i(e,t,o){var s;e.beginPath(),e.arc(o.x,o.y,o.size,0,2*Math.PI),e.fillStyle=null!==(s=o.primaryColor)&&void 0!==s?s:"white",e.fill()}function a(e,t,o){e.beginPath(),e.arc(o.x,o.y,o.size,0,2*Math.PI),e.strokeStyle="#fff",e.stroke()}function r(e,t,o,s,n){const i=s.y-o.y,a=s.x-o.x,r=Math.sqrt(a*a+i*i);if(r<300)return;const c=a/r,l=i/r,d=o.x+290*c,y=o.y+290*l;e.save(),e.beginPath(),e.translate(d,y),e.rotate(Math.atan2(l,c)),e.moveTo(10,0),e.lineTo(-10,-5),e.lineTo(-10,5),e.fillStyle=n,e.fill(),e.restore()}window.mainContext=s;const c={gameHasBeenInitialized:!1,mouse:{x:400,y:300,isDown:!1,wasPressed:!1,isRightDown:!1,wasRightPressed:!1},isUsingKeyboard:!0,keyboard:{gameKeyValues:[],gameKeysDown:new Set,gameKeysPressed:new Set,mostRecentKeysPressed:new Set,gameKeysReleased:new Set},audio:{playingTracks:[]},camera:{x:0,y:0},spaceship:{x:0,y:0,size:20,velocity:{x:0,y:0},rotation:-1.5,reloadTime:200,shootCooldown:0},playerBullets:[],planets:[{x:200,y:200,velocity:{x:0,y:0},size:50,primaryColor:"aqua",secondaryColor:"lime"}],asteroids:[]};function l(){return c}function d(e,t){const o=e.x-t.x,s=e.y-t.y;return(o*o+s*s)**.5}window.state=c;const y=[520,550],h={MENU:0,UP:1,DOWN:2,LEFT:3,RIGHT:4,RUN:5,ACTIVATE:6,SELL:7,POTION:8,AIM_UP:9,AIM_DOWN:10,AIM_LEFT:11,AIM_RIGHT:12,SHOOT:13,SPECIAL_ATTACK:14,MUTE:15,GUARD_SKILL:16},u={ESCAPE:27,LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,SHIFT:16,ENTER:13,BACK_SPACE:8,COMMAND:91,CONTROL:17,LEFT_BRACKET:219,BACK_SLASH:220,RIGHT_BRACKET:221,A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0)},f={[h.MENU]:[u.ENTER],[h.UP]:[u.UP,u.W],[h.DOWN]:[u.DOWN,u.S],[h.LEFT]:[u.LEFT,u.A],[h.RIGHT]:[u.RIGHT,u.D],[h.ACTIVATE]:[u.F],[h.SELL]:[u.X],[h.SHOOT]:[u.SPACE],[h.MUTE]:[u.M],[h.GUARD_SKILL]:[u.SHIFT,u.C,u.V,u.B]},C={[h.MENU]:9,[h.UP]:12,[h.DOWN]:13,[h.LEFT]:14,[h.RIGHT]:15,[h.ACTIVATE]:[0,1],[h.SELL]:3,[h.POTION]:4,[h.SHOOT]:5,[h.SPECIAL_ATTACK]:6},A={[h.UP]:[1,-1],[h.DOWN]:[1,1],[h.LEFT]:[0,-1],[h.RIGHT]:[0,1],[h.AIM_UP]:[3,-1],[h.AIM_DOWN]:[3,1],[h.AIM_LEFT]:[2,-1],[h.AIM_RIGHT]:[2,1]},T=[];let m;function v(e){return T[e]?(m="keyboard",1):0}function p(e){const t=C[e],o=A[e],s=Array.isArray(t)?t:[t];for(const e of s)if(void 0!==e||void 0!==o){const t=navigator.getGamepads();for(const s of t){if(!s)continue;let t=0;if(void 0!==e&&("object"==typeof(n=s.buttons[e])?n.pressed:1==n)?t=1:void 0!==o&&s.axes[o[0]]*o[1]>0&&(t=s.axes[o[0]]*o[1]),t)return t>=.3&&(m="gamepad"),t}}var n;return 0}function x(e,t){return e.keyboard.gameKeysDown.has(t)}let g=null,w=!1,E=!1,I=!1;function P(e){g=[e.pageX,e.pageY]}function S(e){1===e.which&&(w=!0),2===e.which&&(I=!0),3===e.which&&(E=!0)}function z(e){1===e.which&&(w=!1),2===e.which&&(I=!1),3===e.which&&(E=!1)}function M(e){const t=2*Math.PI*Math.random(),o=2*Math.PI*Math.random(),s=y[0]+Math.random()*(y[1]-y[0]);return{x:e.spaceship.x+s*Math.cos(t),y:e.spaceship.y+s*Math.sin(t),velocity:{x:2*Math.cos(o),y:2*Math.sin(o)},size:15,rotation:o}}!function e(){try{window.requestAnimationFrame(e);const t=l();!function(e,t){e.fillStyle="black",e.fillRect(0,0,o.width,o.height),e.save(),e.translate(-t.camera.x,-t.camera.y);for(const o of t.planets)n(e,0,o),r(e,0,t.spaceship,o,"green");for(const o of t.playerBullets)i(e,0,o);for(const o of t.asteroids)a(e,0,o);!function(e,t,o){var s;e.save(),e.translate(o.x,o.y),e.rotate(null!==(s=o.rotation)&&void 0!==s?s:0),e.beginPath(),e.moveTo(o.size/2,0),e.lineTo(-o.size/2,o.size/2),e.lineTo(-o.size/2,-o.size/2),e.closePath(),e.strokeStyle="#fff",e.stroke(),e.restore()}(e,0,t.spaceship),e.restore()}(s,t)}catch(e){console.log(e)}}(),setInterval((function(){const t=l();t.gameHasBeenInitialized||function(t){document.addEventListener("mousemove",P),document.addEventListener("mousedown",S),document.addEventListener("mouseup",z),o.addEventListener("contextmenu",(function(e){v(u.SHIFT)||e.preventDefault()})),addEventListener("blur",(e=>{for(let e=0;e<T.length;e++)T[e]=0})),document.addEventListener("keyup",(function(e){const t=e.which;T[t]=0})),document.addEventListener("keydown",(function(e){if(e.repeat)return;if(e.target.closest("input")||e.target.closest("textarea")||e.target.closest("select"))return;const t=T[u.CONTROL]||T[u.COMMAND],o=e.which;o===u.R&&t||(T[o]=1)})),e(".js-loading").style.display="none",e(".js-gameContent").style.display="",t.gameHasBeenInitialized=!0,t.spaceship.x=o.width/2,t.spaceship.y=o.height/2}(t),function(e){const t=e.keyboard.gameKeysDown;let o=e.keyboard.mostRecentKeysPressed;const s=[],n=new Set,i=new Set,a=new Set;for(let e of Object.values(h)){s[e]=0;for(const t of f[e]||[])if(s[e]=v(t),s[e])break;s[e]||(s[e]=p(e)),s[e]>=.3&&n.add(e)}for(const e of[...t])n.has(e)||a.add(e);for(const e of[...n])t.has(e)||i.add(e);i.size>0&&(o=i),e.keyboard={gameKeyValues:s,gameKeysDown:n,gameKeysPressed:i,gameKeysReleased:a,mostRecentKeysPressed:o},"gamepad"===m?(e.isUsingKeyboard=!1,e.isUsingXbox=!0):"keyboard"===m&&(e.isUsingKeyboard=!0,e.isUsingXbox=!1)}(t),function(e){const t=e.spaceship;let o=0;x(e,h.UP)?o=.15:x(e,h.DOWN)&&(o=-.05),x(e,h.LEFT)&&(t.rotation-=.1),x(e,h.RIGHT)&&(t.rotation+=.1);const s=Math.cos(t.rotation),n=Math.sin(t.rotation);t.velocity.x+=o*s,t.velocity.y+=o*n,t.velocity.x*=.98,t.velocity.y*=.98,t.x+=t.velocity.x,t.y+=t.velocity.y,t.shootCooldown>0&&(t.shootCooldown-=20),t.shootCooldown<=0&&x(e,h.SHOOT)&&(e.playerBullets.push({x:t.x+t.size*s,y:t.y+t.size*n,velocity:{x:5*s+t.velocity.x,y:5*n+t.velocity.y},size:3,rotation:t.rotation}),t.shootCooldown=t.reloadTime)}(t),function(e){for(let t=0;t<e.playerBullets.length;t++){const o=e.playerBullets[t];if(o.x+=o.velocity.x,o.y+=o.velocity.y,d(e.spaceship,o)>500)return void e.playerBullets.splice(t--,1)}}(t),function(e){for(let t=0;t<e.asteroids.length;t++){const o=e.asteroids[t];if(o.x+=o.velocity.x,o.y+=o.velocity.y,d(e.spaceship,o)>600)return void e.asteroids.splice(t--,1)}for(;e.asteroids.length<5;)e.asteroids.push(M(e))}(t),t.camera.x=t.spaceship.x-o.width/2,t.camera.y=t.spaceship.y-o.height/2}),20)})();